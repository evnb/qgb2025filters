<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QGB2025 Game Library</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.1.1/styles/ag-grid.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.1.1/styles/ag-theme-alpine.css">
  <style>
    #filterBar { margin: 1em 0; }
    #myGrid { height: 600px; width: 100%; }
  </style>
</head>
<body>

  <h2>Queer Games Bundle 2025 Game Library</h2>
  <div id="filterBar">
    <input id="filterInput" style="width: 400px;" placeholder='e.g. ( genre-puzzle OR tag-2d ) AND NOT tag-horror'>
    <button onclick="applyBooleanFilter()">Apply Filter</button>
    <span id="gameCount" style="margin-left: 10px; color: #666;"></span>
  </div>

  <div id="myGrid" class="ag-theme-alpine"></div>

  <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.1.1/dist/ag-grid-community.min.js"></script>
  <script src="booleanFilter.js"></script>
  <script src="typeahead.js"></script>
  <script>
    let gridOptions;
    let fullData = [];

    function updateGameCount() {
      const visibleCount = gridOptions.api.getDisplayedRowCount();
      const totalCount = fullData.length;
      document.getElementById('gameCount').textContent = `Showing ${visibleCount} out of ${totalCount} games`;
    }

    fetch('games.json')
      .then(res => res.json())
      .then(data => {
        fullData = data;
        gridOptions = {
          suppressDragLeaveHidesColumns: true, // Prevents columns from being hidden when dragged outside the grid
          columnDefs: [
            { field: "name", filter: true },
            { field: "url", filter: false, cellRenderer: p => `<a href="${p.value}" target="_blank">${p.value}</a>` },
            { field: "authors", filter: false, valueFormatter: p => p.value.join(", ") },
            { field: "tags", filter: false, valueFormatter: p => p.value.join(", "), flex: 2 },
          ],
          rowData: fullData,
          defaultColDef: {
            sortable: true,
            resizable: true,
          }
        };
        const gridDiv = document.querySelector('#myGrid');
        new agGrid.Grid(gridDiv, gridOptions);
        updateGameCount(); // Show initial count
      });

    function applyBooleanFilter() {
      const query = document.getElementById('filterInput').value.trim();
      if (!query) {
        gridOptions.api.setRowData(fullData);
        updateGameCount(); // Update count when clearing filter
        return;
      }
      try {
        const ast = parseBooleanQuery(query);
        const filtered = fullData.filter(row => evaluateAST(ast, row.tags));
        gridOptions.api.setRowData(filtered);
        updateGameCount(); // Update count after applying filter
      } catch (error) {
        console.error('Error applying filter:', error);
        gridOptions.api.setRowData(fullData);
        updateGameCount(); // Update count after error
      }
    }
    
    
  </script>
</body>
</html>


